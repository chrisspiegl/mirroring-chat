(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chat"],{2919:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{staticClass:"fill-height"},[s("div",{staticClass:"boxToFillHeight"},[s("v-row",[s("v-col",[s("div",{staticClass:"boxToFillHeight",staticStyle:{height:"100%"}},[s("v-card",[s("v-toolbar",{attrs:{dense:""}},[s("v-toolbar-title",[e._v(e._s(e.messagesUndone.length)+" Unacknoweledged Messages")]),s("v-spacer")],1)],1),s("div",{staticClass:"chat-container"},[s("vue-scroll",{ref:"vuescrollDone",attrs:{ops:e.vuescrollOptionsDone}},[e._l(e.messagesUndone,(function(t,a){return e.messagesUndone.length>0?s("message",{key:t.idChatMessage,attrs:{provider:t.provider,message:t,index:a,markMessageDone:e.markMessageDone,actionMessageReply:e.actionMessageReply,actionUserBan:e.actionUserBan,actionUserTimeout:e.actionUserTimeout,actionMessageHighlight:e.actionMessageHighlight}}):e._e()})),0===e.messagesUndone.length&&0!==e.messages.length?s("v-card",{staticClass:"mb-2"},[s("v-card-title",{staticClass:"justify-center"},[e._v("INBOX ZERO")]),s("v-card-subtitle",{staticClass:"text-center"},[e._v("You reached the bottom.")])],1):e._e(),0===e.messages.length?s("v-card",{staticClass:"mb-2"},[s("v-card-title",{staticClass:"justify-center"},[e._v("Nothing yet…")]),s("v-card-subtitle",{staticClass:"text-center"},[e._v("Invite some people to your strem and let's chat.")])],1):e._e()],2)],1)],1)]),s("v-col",[s("div",{staticClass:"boxToFillHeight",staticStyle:{height:"100%"}},[s("v-card",[s("v-toolbar",{attrs:{dense:""}},[s("v-toolbar-title",[e._v("Live Chat with "+e._s(e.messagesReversed.length)+" Messages")]),s("v-spacer")],1)],1),s("div",{staticClass:"chat-container"},[s("vue-scroll",{ref:"vuescrollLive",attrs:{ops:e.vuescrollOptionsDone}},[e._l(e.messagesReversed,(function(t,a){return e.messages.length>0?s("message",{key:t.idChatMessage,style:{opacity:t.doneAt?.5:1},attrs:{provider:t.provider,message:t,index:a,markMessageDone:e.markMessageDone,actionMessageReply:e.actionMessageReply,actionUserBan:e.actionUserBan,actionUserTimeout:e.actionUserTimeout,actionMessageHighlight:e.actionMessageHighlight}}):e._e()})),0===e.messages.length?s("v-card",{staticClass:"mb-2"},[s("v-card-title",{staticClass:"justify-center"},[e._v("Nothing yet…")]),s("v-card-subtitle",{staticClass:"text-center"},[e._v("Invite some people to your strem and let's chat.")])],1):e._e()],2)],1)],1)])],1),s("div",[s("v-system-bar",{attrs:{color:"transparent"}},[s("v-spacer"),e.lastUpdated&&e.messages.length>0?s("span",[e._v("Last message "+e._s(e._f("moment")(e.lastUpdated,"from",e.time)))]):e._e()],1)],1)],1)])},i=[],n=s("2f62"),o=s("e1e5"),r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-expand-transition",[s("v-card",{staticClass:"mb-2",class:e.message.provider+"-bg",attrs:{outlined:""}},[s("v-list-item",[s("v-list-item-avatar",{staticClass:"mr-2 my-0",attrs:{size:"30"}},[s("v-img",{attrs:{src:e.avatar(e.message)}})],1),s("v-list-item-content",[s("v-list-item-title",[s("v-icon",{attrs:{size:"1rem"}},[e._v("$"+e._s(e.message.provider))]),e._v("/"+e._s(e.message.displayName))],1)],1),s("v-list-item-action-text",[s("v-card-actions",[s("v-btn",{attrs:{icon:"",title:"Ban"},on:{click:function(t){return e.actionUserBan(e.index,e.message)}}},[s("v-icon",[e._v("$ban")])],1),s("v-btn",{attrs:{icon:"",title:"Timeout"},on:{click:function(t){return e.actionUserTimeout(e.index,e.message)}}},[s("v-icon",[e._v("$timeout")])],1),s("v-btn",{attrs:{icon:"",title:"Highlight this message"},on:{click:function(t){return e.actionMessageHighlight(e.index,e.message)}}},[s("v-icon",[e._v("$highlight")])],1),s("v-btn",{attrs:{icon:"",title:"Reply to this message"},on:{click:function(t){return e.actionMessageReply(e.index,e.message)}}},[s("v-icon",[e._v("$reply")])],1),s("v-btn",{attrs:{icon:"",title:"Archive"},on:{click:function(t){return e.markMessageDone(e.index,e.message)}}},[s("v-icon",[e._v("$check")])],1)],1)],1)],1),s("v-card-text",[s("v-list-item-action-text",{staticStyle:{float:"right"}},[e._v(e._s(e._f("moment")(e.message.sentAt,"from",e.time)))]),s("div",{domProps:{innerHTML:e._s(e.message.message)}})],1)],1)],1)},l=[],c={props:["message","provider","index","markMessageDone","actionMessageReply","actionUserBan","actionUserTimeout","actionMessageHighlight"],computed:{...Object(n["b"])(["getProfile","isAuthenticated","isProfileLoaded"]),...Object(n["c"])({channelName:e=>e.user.profile.idUser,user:e=>e.user.profile,time:e=>e.time.now})},created(){},methods:{avatar(e){let t=`https://api.adorable.io/avatars/285/${e.displayName}.png`;switch(e.provider){case"twitch":e.providerObject&&e.providerObject.userHelix&&(t=e.providerObject.userHelix.profile_image_url);break;case"youtube":t=e.providerObject.authorDetails.profileImageUrl;break;default:break}return t}}},d=c,m=(s("7243"),s("2877")),g=s("6544"),h=s.n(g),u=s("8336"),v=s("b0af"),p=s("99d9"),b=s("0789"),f=s("132d"),y=s("adda"),$=s("da13"),_=s("5d23"),C=s("8270"),M=Object(m["a"])(d,r,l,!1,null,null,null),T=M.exports;h()(M,{VBtn:u["a"],VCard:v["a"],VCardActions:p["b"],VCardText:p["d"],VExpandTransition:b["e"],VIcon:f["a"],VImg:y["a"],VListItem:$["a"],VListItemActionText:_["e"],VListItemAvatar:C["a"],VListItemContent:_["g"],VListItemTitle:_["k"]});var k={name:"Chat",components:{Message:T},computed:{...Object(n["b"])(["getProfile","isAuthenticated","isProfileLoaded"]),...Object(n["c"])({channelName:e=>e.user.profile.idUser,user:e=>e.user.profile,time:e=>e.time.now}),messagesUndone(){return this.messages.filter(e=>!e.doneAt&&!e.message.startsWith("!drop"))},messagesReversed(){return this.messages.slice().reverse()}},data(){return{newMessage:null,messages:[],lastUpdated:null,scrollBottom:!0,scrollBottomOnInit:!0,vuescrollOptionsDone:{scrollPanel:{scrollingX:!1,scrollingY:!0}},vuescrollOptionsLive:{scrollPanel:{initialScrollY:"100%",scrollingX:!1,scrollingY:!0}}}},mounted(){this.$log.debug("Chat.vue mounted"),Object(o["a"])({url:"/v1/chat/messages/"+this.user.idUser,method:"GET"}).then(e=>{e.data.messages.forEach(e=>{this.messages.push(e)}),this.lastUpdated=new Date}).catch(e=>{this.$log.error("Error requesting chat messages: ",e)})},watch:{newMessage(e){this.$log.debug("Typing: ",e)},messages(e){this.$log.debug("Currently displaying "+e.length)}},methods:{markMessageDone(e,t){this.$set(t,"doneAt",new Date),Object(o["a"])({url:"/v1/chat/message/"+t.idChatMessage,method:"PUT",data:{message:t}}).then(e=>{this.$toast(`Message by ${t.displayName} marked done.`)}).catch(e=>{this.$log.error("PUT /v1/chat/message/"+t.idChatMessage,e)})},actionMessageReply(e,t){},async actionUserBan(e,t){const s=await this.$confirm(`Do you really want to ban <b>${t.displayName}</b>?`,{color:"error",title:"Banning - "+t.displayName,buttonTrueText:"Yes",buttonFalseText:"No"});s&&Object(o["a"])({url:`/v1/chat/message/${t.idChatMessage}/ban`,method:"POST",data:{message:t}}).then(e=>{this.$toast(e.message)}).catch(e=>{this.$toast(`Failed to ban ${t.displayName} from the live chat.`),this.$log.error("Failed to ban user",e)})},async actionUserTimeout(e,t){const s=await this.$confirm(`Do you really want to send <b>${t.displayName}</b> into timeout?`,{color:"warning",title:"Timeout for "+t.displayName,buttonTrueText:"Yes",buttonFalseText:"No"});s&&(this.$toast(`Sent ${t.displayName} into timeout.`),Object(o["a"])({url:`/v1/chat/message/${t.idChatMessage}/timeout`,method:"POST",data:{message:t}}).then(e=>{this.$toast(e.message)}).catch(e=>{this.$toast(`Failed to timeout ${t.displayName} from the live chat.`),this.$log.error("Failed to timeout user",e)}))},actionMessageHighlight(e,t){},send(){this.$log.debug("Message Typed and Hit Enter: ",this.newMessage)}},sockets:{connect(){this.$log.debug("chat socket connected")},hello(e){this.$log.debug("socket on *hello* with",e)},server(e){this.$log.debug("server: ",e)}},created(){this.sockets.subscribe("message-to-"+this.channelName,e=>{this.$log.debug("socket received message for "+this.channelName),e.data.messages.forEach(e=>{this.messages.push(e),this.lastUpdated=new Date})}),this.$socket.emit("hello","client says hey"),this.$socket.emit("chat-channel-connect",{channelName:this.channelName})},updated(){},destroyed(){this.$socket.emit("chat-channel-disconnect",{channelName:this.channelName})}},U=k,x=(s("f16b"),s("62ad")),w=s("a523"),O=s("0fd9"),N=s("2fa4"),V=s("afd9"),j=s("71d9"),D=s("2a7f"),H=Object(m["a"])(U,a,i,!1,null,"28d1494b",null);t["default"]=H.exports;h()(H,{VCard:v["a"],VCardSubtitle:p["c"],VCardTitle:p["e"],VCol:x["a"],VContainer:w["a"],VRow:O["a"],VSpacer:N["a"],VSystemBar:V["a"],VToolbar:j["a"],VToolbarTitle:D["c"]})},7130:function(e,t,s){},7243:function(e,t,s){"use strict";var a=s("943b"),i=s.n(a);i.a},"943b":function(e,t,s){},c1e5:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{staticClass:"admin"},[s("h1",[e._v("Admin")])])},i=[],n={name:"Admin",components:{},mounted(){this.$log.debug("Admin.vue mounted")}},o=n,r=s("2877"),l=s("6544"),c=s.n(l),d=s("a523"),m=Object(r["a"])(o,a,i,!1,null,null,null);t["default"]=m.exports;c()(m,{VContainer:d["a"]})},f16b:function(e,t,s){"use strict";var a=s("7130"),i=s.n(a);i.a}}]);